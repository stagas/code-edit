var{replace:e}="",t=/[&<>'"]/g,n={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},i=e=>n[e],s=n=>e.call(n,t,i),o=async(e,t=new Set)=>{const n=(await(await(e?.default)??e))?.default??e;if(!n)throw new ReferenceError("Could not find definition for language");const i={},s=[];for(let[e,l]of Object.entries(n))t.add(e),Array.isArray(l)&&(i[e]=await o(l[1],t),l=l[0]),s.push(`(?<${e}>${l?.source??l})`);const l=RegExp(s.join("|"),"gm");return l.map=i,l.keys=t,l},l=(e,t)=>t.replace(RegExp("("+e.source+")|(?<catchbad>[&<>\"'])","gm"),((...t)=>{const n=t.pop(),i=Object.entries(n).filter((e=>null!=e[1])),[o,r]=i[0];if("catchbad"===o)return s(r);if(e.map){const t=e.map[o];if(t)return`<span class="${o}-outer">${l(t,r)}</span>`}return`<span class="${o}">${s(r)}</span>`})),r=new Map,a={},h=class extends HTMLElement{static get observedAttributes(){return["language","theme","html"]}#e=[];pins={};constructor(){super();const e=this.attachShadow({mode:"open"});e.innerHTML='<slot style="display:none"></slot><pre style="margin:0"><code></code></pre>',this.pins.code=e.querySelector("code");const t=new MutationObserver(this.render),n=e.querySelector("slot");n.addEventListener("slotchange",(()=>{this.#e=n.assignedNodes(),this.#e.forEach((e=>t.observe(e,{characterData:!0}))),this.render()}))}highlight=e=>s(e);render=()=>{this.html=this.highlight(this.#e.map((e=>{const t=e.textContent;return t.trim().length?t:""})).join(""))};set html(e){this.pins.code.innerHTML=e}set syntax(e){this.setSyntaxDefinition(e)}set styleSheet(e){this.shadowRoot.adoptedStyleSheets=[e]}async setSyntaxDefinition(e){let{style:t,regexp:n}=r.get(e)??{};t||(n=await o(e),t=(e=>{const t=new CSSStyleSheet;return t.replaceSync("*{color:var(--color);}*::selection{background:var(--selection)!important}"+e.map((e=>`.${e}{color:var(--${e});font-style:var(--${e}-style);font-weight:var(--${e}-weight)}`)).join("")),t})([...n.keys]),r.set(e,{style:t,regexp:n})),this.styleSheet=t,this.highlight=e=>l(n,e),this.render()}attributeChangedCallback(e,t,n){"language"===e&&n&&n in a&&this.setSyntaxDefinition(a[n]),"theme"===e&&this.setAttribute("code-syntax-theme",n),"html"===e&&(this.html=n??"")}},c=e=>{let t=!1,n=[];function i(){try{e.apply(this,n)}finally{t=!1}}return function(...e){n=e,t||(t=!0,queueMicrotask(i))}},u=class extends HTMLElement{leaderSlot;followerSlot;scrollEl;#t;constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML='<style>\n  :host {\n    position: relative;\n    overflow: hidden;\n    display: inline-flex;\n    resize: both;\n    width: 100%;\n    height: 100%;\n  }\n\n  #leader {\n    position: absolute;\n    top: 0;\n    left: 0;\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n  }\n\n  #leader::slotted(:first-child) {\n    display: inline-flex;\n    width: 100%;\n    height: 100%;\n    overflow: scroll;\n    resize: none !important;\n    margin: 0;\n    box-sizing: border-box;\n  }\n\n  [name="follower"] {\n    left: 0;\n    top: 0;\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n  }\n\n  [name="follower"] {\n    display: contents;\n  }\n\n  [part="scroll"] {\n    pointer-events: none;\n    position: absolute;\n    top: 0;\n    left: 0;\n  }\n</style><slot id="leader"></slot><div part="scroll"><slot name="follower"></slot></div>',this.leaderSlot=this.shadowRoot.querySelector("#leader"),this.followerSlot=this.shadowRoot.querySelector('[name="follower"]'),this.scrollEl=this.shadowRoot.querySelector('[part="scroll"]'),this.shadowRoot.addEventListener("slotchange",(()=>{const e=this.leaderSlot.assignedNodes().filter((e=>e.nodeType!==document.TEXT_NODE))[0];e&&(this.#t=e,this.#t.addEventListener("scroll",(()=>{Object.assign(this.scrollEl.style,{left:-this.#t.scrollLeft+"px",top:-this.#t.scrollTop+"px"}),this.dispatchEvent(new CustomEvent("scroll",{bubbles:!0}))})))}))}get scrollLeft(){return this.#t.scrollLeft}get scrollTop(){return this.#t.scrollTop}},d=e=>e.match(/[^\s]|$/m).index+1,p=(e,t,n=1)=>{let i=e.reduce(((e,i,s)=>{const o=d(i);return o>=n&&o<e.col?{line:s+t,col:o}:o===e.col?{line:s+t,col:e.col}:e}),{line:1/0,col:1/0});return isFinite(i.line)&&isFinite(i.col)||(i={line:t+e.length+1,col:1}),i},g="undefined"==typeof document||void 0===document.execCommand?(e,t=document.activeElement)=>t.value=t.value.slice(0,t.selectionStart)+e+t.value.slice(t.selectionEnd):e=>document.execCommand("insertText",!1,e),f={tabStyle:"spaces",tabSize:2,comments:["//","/*","*/"]},m=class{#n;insert;options;constructor(e,t,n={}){this.#n=e,this.insert=t,this.options=Object.assign({},f,n)}get value(){return this.#n.value}get tab(){return"tabs"===this.options.tabStyle?"\t":" ".repeat(this.options.tabSize)}get numberOfLines(){return~this.value.indexOf("\n")&&this.value.split("\n").length||1}static lineAt(e,t){return e.split(/\n/).at(t)}lineAt(e){return m.lineAt(this.value,e)}scrollIntoView(e){const{selectionStart:t,selectionEnd:n,selectionDirection:i}=this.#n;null==e&&(e="forward"===i?n:t),this.#n.setSelectionRange(e,e),this.#n.blur(),this.#n.focus(),this.#n.setSelectionRange(t,n,i)}getRange(){const{selectionStart:e,selectionEnd:t,selectionDirection:n}=this.#n,[i,s]=[e,t].map(this.getLineCol),[o,l]="forward"===n?[s,i]:[i,s];return{start:i,end:s,head:o,tail:l,hasSelection:e!==t,selectionStart:e,selectionEnd:t,selectionDirection:n}}getLineCol=e=>m.getLineCol(this.value,e);static getLineCol(e,t){let n=1,i=1;for(let s=0;s<t;s++)"\n"===e.charAt(s)&&(n++,i=0),i++;return{line:n,col:i}}getPositionFromLineCol(e){return m.getPositionFromLineCol(this.value,e)}static getPositionFromLineCol(e,t){const{line:n,col:i}=t,s=e.split("\n");if(n>s.length)return e.length;if(n<1)return 0;const o=s.slice(0,n);return o[o.length-1]=o.at(-1).slice(0,Math.max(1,i)-1),o.join("\n").length}getArea({start:e,end:t}){return[this.getPositionFromLineCol(e),this.getPositionFromLineCol(t)]}setSelectionRange(e,t,n){e=Math.max(0,e),t=Math.min(this.value.length,t),this.#n.setSelectionRange(e,t,n)}moveCaretTo({line:e,col:t},n,i=this.#n.selectionDirection){const s=this.getPositionFromLineCol({line:e,col:t}),o=n?this.getPositionFromLineCol(n):s;if(n){const e=Math["backward"===i?"min":"max"](s,o);this.setSelectionRange(e,e),this.scrollIntoView()}this.setSelectionRange(Math.min(s,o),Math.max(s,o),s<o?"backward":"forward"),this.scrollIntoView()}replaceBlock(e){const{start:t,end:n,hasSelection:i,selectionDirection:s}=this.getRange(),o=this.lineAt(t.line-1),l=this.lineAt(n.line-1),r=n.col>1||!i?1:0,a=this.getPositionFromLineCol({line:t.line,col:1}),h=this.getPositionFromLineCol({line:n.line+r,col:1}),c=this.value.slice(a,h),{diff:u,text:d,left:p}=e(c,t.line);if(d.length===h-a)return;this.setSelectionRange(a,h),this.insert(d),this.scrollIntoView(this.getPositionFromLineCol({line:n.line-+!r,col:p.col+u}));const g=!i&&t.col<=p.col+u&&n.col<=p.col+u&&0!==o.length,f=this.lineAt(t.line-1)===o||g?t.col:t.col+u,m=g||this.lineAt(n.line-1)===l?n.col:0===c.length?n.col+u:Math.max(1+(t.line!==n.line?r:0),n.col+r*u);this.setSelectionRange(this.getPositionFromLineCol({line:t.line,col:f}),this.getPositionFromLineCol({line:n.line,col:m}),s)}toggleSingleComment(){const e=this.options.comments[0];this.replaceBlock(((t,n)=>{const i=p(t.split("\n").filter((e=>e.length)),n);let s;return t.trimStart().slice(0,2)===e?(s=-3,t=t.replace(new RegExp(`^([^/]*)${e} ?`,"gm"),"$1")):(s=3,t=0===t.length?e+" ":t.replace(new RegExp(`^(?!$)([^/]{0,${i.col-1}})`,"gm"),`$1${e} `)),{diff:s,text:t,left:i}}))}toggleDoubleComment(){let{selectionStart:e,selectionEnd:t,selectionDirection:n}=this.getRange(),i=this.value.slice(e,t);const s=this.options.comments,o=this.value.slice(e-s[1].length,t+s[2].length);if(0===o.indexOf(s[1])&&o.lastIndexOf(s[2])===o.length-s[2].length&&(i=o,e-=s[1].length,t+=s[2].length,this.setSelectionRange(e,t,n)),0===i.indexOf(s[1])&&i.lastIndexOf(s[2])===i.length-s[2].length){const o=i.slice(s[1].length,-s[2].length);this.insert(o),this.setSelectionRange(e,t-s[1].length-s[2].length,n)}else{this.insert(s[1]+i+s[2]);const o=s[1].length;this.setSelectionRange(e+o,t+o,n)}this.scrollIntoView()}indent(e){this.replaceBlock(((t,n)=>{const i=p(t.split("\n"),n,2);let s;return e?(s=-this.options.tabSize,t=t.replace(new RegExp(`^(\t| {1,${this.options.tabSize}})`,"gm"),"")):(s=+this.options.tabSize,t=0===t.length?this.tab:t.replace(/^[^\n]/gm,`${this.tab}$&`)),{diff:s,text:t,left:i}}))}moveCaretHome(e){const{head:t,tail:n}=this.getRange();let i=d(this.lineAt(t.line-1));t.col===i&&(i=1),this.moveCaretTo({line:t.line,col:i},e?n:null)}moveCaretEnd(e){const{head:t,tail:n}=this.getRange();this.moveCaretTo({line:t.line,col:this.lineAt(t.line-1).length+1},e?n:null)}moveCaretLines(e,t){const{head:n,tail:i}=this.getRange(),{numberOfLines:s}=this;let o=n.line+e;o<1&&n.line>1?o=1:o>s&&n.line<s&&(o=s),this.moveCaretTo({line:o,col:n.col},t?i:null)}moveLines(e){const{start:t,end:n,hasSelection:i,selectionStart:s,selectionEnd:o,selectionDirection:l}=this.getRange(),r=this.value.split("\n"),a=1===n.col&&i?1:0,h=e>0;let c=t.line+(h?0:e),u=n.line+(h?e:0)-a;if(h){const t=u-r.length;t>0&&(u-=t,e-=t)}else{const t=1-c;t>0&&(c+=t,e+=t)}if(!e)return;const d={start:{line:c,col:1},end:{line:u,col:this.lineAt(u-1).length+1}},[p,g]=this.getArea(d),f=this.value.slice(p,g).split("\n"),m=h?n.line-a-t.line+1:-e,b=f.slice(0,m),x=f.slice(m);this.setSelectionRange(p,g,l),this.insert(x.concat(b).join("\n"));const v=h?x.join("\n").length+1:-(b.join("\n").length+1),y=s+v,S=o+v;this.setSelectionRange(y,S,l),this.scrollIntoView(h?S:y)}duplicate(){const{start:e,end:t,hasSelection:n,selectionStart:i,selectionEnd:s,selectionDirection:o}=this.getRange(),{numberOfLines:l}=this;n||(e.col=1,t.col=1,t.line++);const[r,a]=this.getArea({start:e,end:t});let h=this.value.slice(r,a);n||"\n"===h.at(-1)||(h=l>1?this.value.slice(r-1,a):"\n"+h),this.setSelectionRange(a,a),this.insert(h);const c=h.length;n?this.setSelectionRange(a,a+c,o):this.setSelectionRange(i+c,s+c),this.scrollIntoView()}deleteLine(){const{start:e,end:t,hasSelection:n}=this.getRange(),{numberOfLines:i}=this,s={line:e.line,col:e.col};n||(t.line<i?(e.col=1,t.col=1,t.line++):1===i?(e.col=1,t.col=this.value.length+1):(s.line--,e.line--,e.col=this.lineAt(t.line-2).length+1,t.col=this.lineAt(t.line-1).length+1));const[o,l]=this.getArea({start:e,end:t});this.setSelectionRange(o,l),this.insert("");const r=this.getPositionFromLineCol(s);this.setSelectionRange(r,r),this.scrollIntoView()}},b=class extends HTMLTextAreaElement{static get observedAttributes(){return["tabsize","tabstyle","comments"]}buffer;pageSize=10;constructor(){super(),this.buffer=new m(this,g),this.attachEvents()}connectedCallback(){this.setAttribute("wrap","off"),this.wrap="off",this.style.whiteSpace="pre"}updateSizes(){const e=parseFloat(window.getComputedStyle(this).getPropertyValue("line-height"))||16;this.pageSize=Math.floor(this.offsetHeight/e)-1}attachEvents(){new ResizeObserver((()=>this.updateSizes())).observe(this),this.addEventListener("keydown",(e=>{const t=e.ctrlKey||e.metaKey;if(t){if("/"===e.key)return e.preventDefault(),void this.buffer.toggleSingleComment();if("?"===e.key)return e.preventDefault(),void this.buffer.toggleDoubleComment();if("D"===e.key)return e.preventDefault(),void this.buffer.duplicate()}if((e.altKey||t&&e.shiftKey)&&["ArrowUp","ArrowDown","PageUp","PageDown"].includes(e.key))return e.preventDefault(),void this.buffer.moveLines({ArrowUp:-1,ArrowDown:1,PageUp:-this.pageSize,PageDown:this.pageSize}[e.key]);if(e.shiftKey&&"Delete"===e.key)return e.preventDefault(),void this.buffer.deleteLine();if(!t&&!e.altKey){if("Tab"===e.key){e.preventDefault();const{selectionStart:t,selectionEnd:n}=this;return void(t!==n||e.shiftKey?this.buffer.indent(e.shiftKey):(this.buffer.insert(this.buffer.tab),this.buffer.scrollIntoView()))}if("Home"===e.key)return e.preventDefault(),void this.buffer.moveCaretHome(e.shiftKey);if("End"===e.key)return e.preventDefault(),void this.buffer.moveCaretEnd(e.shiftKey);if(["PageUp","PageDown"].includes(e.key))return e.preventDefault(),void this.buffer.moveCaretLines("PageUp"===e.key?-this.pageSize:+this.pageSize,e.shiftKey)}if(!t&&!e.altKey&&!e.shiftKey&&"Enter"===e.key){const{start:t,selectionStart:n}=this.buffer.getRange(),i=this.buffer.lineAt(t.line-1),s=d(i);if(s>0){e.preventDefault();let o="\n"+i.slice(0,s-1);~"{[(".indexOf(i.at(-1))&&t.col===i.length+1&&(o+=this.buffer.tab);const l=n+o.length;return this.buffer.insert(o),this.buffer.setSelectionRange(l,l),void this.buffer.scrollIntoView()}}}))}attributeChangedCallback(e,t,n){"tabsize"===e&&(this.buffer.options.tabSize=parseInt(n||"")||2),"tabstyle"===e&&(this.buffer.options.tabStyle="spaces"===n||"tabs"===n?n:"spaces"),"comments"===e&&(this.buffer.options.comments=(n||"// /* */").split(" "))}},x=window.customElements;x.define("textarea-code",b,{extends:"textarea"});try{x=new CustomElementRegistry}catch{}x.define("super-impose",u),x.define("code-syntax",h);var v=document.createElement("template");v.innerHTML='<style>\n:host {\n  --caret: #fff;\n  --selection: #742;\n  position: relative;\n  display: inline-flex;\n  overflow: hidden;\n}\n:host([autoresize]) [part=parent] {\n  resize: horizontal;\n}\n[part=parent] {\n  background: var(--background, transparent);\n}\npre,\ntextarea {\n  white-space: pre;\n  padding: 0;\n  margin: 0;\n  width: 100%;\n  height: 100%;\n  font-size: inherit;\n  line-height: inherit;\n  resize: none;\n  background: transparent;\n  color: transparent;\n  caret-color: var(--caret);\n  border: none;\n}\npre {\n  position: absolute;\n  width: auto;\n  height: auto;\n  z-index: -1;\n}\ntextarea::selection {\n  color: transparent;\n  background: var(--selection) !important;\n}\nslot {\n  display: none;\n}\n</style><pre></pre><slot></slot><super-impose part="parent"><textarea part="textarea" autocomplete="off" autocorrect="off" spellcheck="false" is="textarea-code"></textarea><code-syntax slot="follower" part="syntax"> </code-syntax></super-impose>';var y=class extends HTMLElement{static get observedAttributes(){return["language","theme","tabsize","tabstyle","comments","autofocus","autoresize"]}nodes=[];pins={};update;constructor(){super();const e=this.attachShadow({mode:"open",customElements:x});e.appendChild(document.importNode(v.content,!0)),this.pins.pre=e.querySelector("pre"),this.pins.parent=e.querySelector("[part=parent]"),this.pins.syntax=e.querySelector("[part=syntax]"),this.pins.syntaxTextNode=this.pins.syntax.childNodes[0],this.update=c((()=>{this.pins.syntaxTextNode.nodeValue=this.pins.textarea.value,this.autoResize()})),this.pins.textarea=e.querySelector("[part=textarea]"),this.pins.textarea.addEventListener("input",this.update),this.pins.textarea.addEventListener("scroll",(()=>{this.dispatchEvent(new CustomEvent("scroll"))}));const t=new MutationObserver(this.updateValue),n=e.querySelector("slot");n.addEventListener("slotchange",(()=>{this.nodes=n.assignedNodes(),this.nodes.forEach((e=>t.observe(e,{characterData:!0}))),this.updateValue()})),this.update()}get scrollLeft(){return this.pins.textarea.scrollLeft}get scrollTop(){return this.pins.textarea.scrollTop}get value(){return this.pins.textarea.value}set value(e){this.pins.textarea.value=e,this.update()}set syntax(e){this.pins.syntax.syntax=e}focus(){this.pins.textarea.focus()}updateValue(){this.value=this.nodes.map((e=>{const t=e.textContent;return t.trim().length?t:""})).join("")}autoResize(){if(this.hasAttribute("autoresize")){this.pins.pre.textContent=this.value+" ";const e=this.pins.pre.getBoundingClientRect();this.pins.parent.style.height=e.height+"px"}}autoFocus(){this.hasAttribute("autofocus")&&setTimeout((()=>{this.pins.textarea.focus(),setTimeout((()=>{this.pins.textarea.setSelectionRange(0,0)}))}))}attributeChangedCallback(e,t,n){"theme"===e&&(this.setAttribute("code-syntax-theme",n),this.pins.textarea.setAttribute(e,n)),["tabsize","tabstyle","comments"].includes(e)?this.pins.textarea.setAttribute(e,n):["language","theme"].includes(e)?(this.pins.parent.setAttribute(e,n),this.pins.syntax.setAttribute(e,n)):"autofocus"===e?this.autoFocus():"autoresize"===e&&this.autoResize()}},S=y;export{y as CodeEditElement,S as default,a as languages};